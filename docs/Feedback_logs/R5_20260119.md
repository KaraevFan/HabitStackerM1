# Habit Stacker Setup Wizard — Iteration 2 Feedback

## Summary

The structural improvements from the last feedback round landed correctly: flow order is fixed, confirmation shows real inference, system design is interactive. However, **the AI personalization pipeline is broken** — Portrait, questions, and habit recommendations are all ignoring the user's actual input. The user selected "Improve sleep" and typed about wanting 7.5 hours of sleep, but the system generated exercise content throughout.

This is now the #1 blocker. Fix the data flow before iterating on UI.

---

## Test Scenario

**User input:** Selected "Improve sleep" from Health & Fitness pills, also entered free-text: "I want to be able to get more sleep, about 7.5 hours, and I also want to wake up earlier around 6 a.m. or so."

**Expected behavior:** All downstream screens (Portrait, Questions, Habit recommendations, Anchors) should be tailored to sleep habits.

**Actual behavior:** All downstream screens showed generic exercise/movement content instead.

---

## What's Working (Don't Break These)

| Element | Status | Notes |
|---------|--------|-------|
| **Flow order** | ✅ Fixed | Portrait → Context → Habit → System → Contract |
| **Intent screen hybrid input** | ✅ Good | Free-text prominent, pills as secondary, "Selected: X" confirmation badge |
| **Mutual exclusion on intent** | ✅ Good | Text input blocks pill selection and vice versa |
| **Confirmation inference** | ✅ Good | "You've tried this many times, and it keeps slipping off your radar" + insight about motivation vs. system |
| **System design interactivity** | ✅ Good | 6 anchor options + custom input + live preview |
| **Contract screen** | ✅ Good | Clean snapshot, "Why this survives bad days" explanation |
| **3-question limit** | ✅ Good | Reduced from 5, appropriate friction level |

---

## Critical Issues

### Issue #1: AI Pipeline Not Using User Intent (P0 — Blocks Everything)

**Problem:** The user's domain selection and free-text input are not being passed to downstream AI generation. The system shows exercise content when user selected sleep.

**Evidence:**
- Portrait shows: "They treat movement as non-negotiable, like brushing teeth"
- Portrait should show: "They have a consistent wind-down signal that tells their brain sleep is coming"
- Habit recommendations show: "Do 5 pushups," "Walk around the block," "2-minute morning stretch"
- Habit recommendations should show: "Put phone in another room 30 min before bed," "Dim lights at 9pm," "Read instead of scroll in bed"

**Hypothesis:** Either:
1. The free-text input isn't being sent to the AI (only the last-clicked pill)
2. The prompt template isn't including user intent when generating Portrait/habits
3. There's a hardcoded fallback to "exercise" when the AI call fails
4. Clicking around on pills during testing contaminated the state even after entering text

**Required fix:** 
1. Add logging to see exactly what payload reaches Portrait, Questions, and Habits generation
2. Identify where "sleep" intent is being lost or overridden
3. Ensure the full user intent (domain + sub-problem + free-text) flows through to all AI calls

**Acceptance criteria:**
- User selects "Improve sleep" → Portrait shows sleep-specific content
- User types about sleep → Portrait shows sleep-specific content
- Habit recommendations match the selected domain
- Anchor suggestions are contextually appropriate for the domain

---

### Issue #2: Portrait Content is Generic, Not Domain-Specific (P1)

**Problem:** Portrait screen shows generic "habit formation 101" advice about building any habit, not domain-specific insight about what success looks like for sleep.

**Current content (wrong):**
```
PEOPLE WHO SUCCEED AT THIS
• They don't rely on motivation — they have a routine that runs on autopilot
• They started embarrassingly small and built from there
• They treat movement as non-negotiable, like brushing teeth
• They recover from breaks quickly because the habit is simple to restart

THE JOURNEY
W1: Show up and move for 2 minutes, no matter what
M1: Consistent movement 4-5 days/week, even if brief
M3: Natural urge to move; workouts feel like a reward, not a chore
```

**Expected content (for sleep domain):**
```
PEOPLE WHO SUCCEED AT THIS
• They have a consistent wind-down signal that tells their brain "sleep is coming"
• They protect the hour before bed from screens and stimulating activities
• They've made their bedroom a sleep-only zone
• They're consistent with bedtime, even on weekends

THE JOURNEY
W1: Establish one consistent pre-sleep action
M1: Wind-down routine feels automatic; falling asleep is easier
M3: Sleep quality noticeably improved; morning energy better

COMMON TRAPS TO AVOID
• Trying to fix everything at once (screens, caffeine, timing, temperature)
• Weekend catch-up sleep (disrupts your rhythm)
• Using the bedroom for work or entertainment

HIGHEST-LEVERAGE STARTING MOVES
• Start with one consistent wind-down trigger
• Make it something you actually enjoy (reading, stretching, tea)
```

**Required fix:** Portrait content must be generated based on the user's selected domain/intent, not served as a static template.

---

### Issue #3: Context Questions Not Filtered by Domain (P1)

**Problem:** The question "When could you realistically do this?" doesn't make sense for sleep habits. The answer is always "evening/night."

**Current questions (same for all domains):**
1. When could you realistically do this? (Morning / Midday / Evening / Flexible)
2. What usually gets in the way? (Not enough time / Too tired / Hard to start / I forget)
3. Have you tried building this habit before? (First time / Once or twice / Many times)

**Required fix:** Create domain-specific question sets:

| Domain | Questions to Ask | Questions to Skip/Replace |
|--------|------------------|---------------------------|
| **Sleep** | What usually disrupts your sleep? / Do you have a consistent bedtime? / Have you tried sleep routines before? | Skip "When could you do this?" (always evening) |
| **Exercise** | When could you realistically do this? / What usually gets in the way? / Have you tried before? | (use current set) |
| **Finance** | When would you review finances? / What makes it hard to stick to? / Have you tried tracking before? | (similar to current) |

**Alternative minimal fix:** If domain-specific question sets are too complex for this iteration, at least skip the "When could you do this?" question for sleep domain since the answer is implicit.

---

### Issue #4: Habit Recommendations Ignore User Intent (P0)

**Problem:** User selected sleep improvement. System recommended exercise habits.

**Current recommendations (wrong):**
- Do 5 pushups (or wall pushups) — "builds the 'I exercise' identity"
- Walk around the block once
- 2-minute morning stretch

**Expected recommendations (for sleep):**
- Put phone in another room 30 min before bed — "removes biggest sleep disruptor"
- Dim lights 1 hour before bed — "signals your brain it's wind-down time"
- Read a physical book for 5 minutes in bed — "replaces scrolling with calming activity"

**Required fix:** Habit recommendation AI call must include the user's domain/intent. The "Why this fits you" reasoning should reference both:
1. The user's stated goal (sleep improvement)
2. The user's constraint answers (forgetting, tried many times, etc.)

---

### Issue #5: Anchor Suggestions Are Generic (P2)

**Problem:** Anchor options are the same regardless of domain. For sleep habits, "After morning coffee" and "When I sit down to work" don't make sense.

**Current anchors (generic):**
- After morning coffee
- After any meal
- During a break
- When I sit down to work
- After checking my phone
- After my first coffee

**Expected anchors (for sleep domain):**
- After brushing teeth at night
- After putting on pajamas
- When I get into bed
- After dinner cleanup
- After setting tomorrow's alarm
- When I turn off the TV for the night

**Required fix:** Anchor suggestions should be generated or filtered based on:
1. The selected domain (sleep = evening anchors)
2. The selected habit (if habit involves bedroom, anchors should be bedroom-adjacent)

---

### Issue #6: No Environment Setup Option (P3 — Enhancement)

**Problem:** The first CTA is always "Do your first rep." But for some habits, the highest-leverage first action is environment setup, not execution.

**Example for sleep:**
- Current CTA: "Start first rep now (≤2 min)" → Do 5 pushups
- Better CTA: "Set up your environment tonight" → Put phone charger in another room

**Recommendation:** Consider adding an optional "Prime your environment" step before or alongside the first rep CTA. This is especially relevant for:
- Sleep (move phone charger, set out book)
- Exercise (set out workout clothes, prep gym bag)
- Finance (bookmark the app, set up account access)

**This is P3 — not blocking, but worth considering for next iteration.**

---

## Minor Issues

### Issue #7: Typo in Confirmation Screen
**Location:** Bottom of confirmation screen (image 7)
**Problem:** Shows "Flexible timing work best" — should be "works" not "work"
**Fix:** Correct the copy

### Issue #8: Design Language Consideration
**Location:** Landing screen
**Problem:** Pure black-and-white minimal design may set a clinical tone rather than warm/supportive
**Status:** Not urgent. Worth revisiting once the flow is functionally correct.
**Consideration:** Explore whether subtle color accents or warmer typography could better convey the "calm coach" emotional tone described in the PRD.

---

## Recommended Implementation Order

### Phase 1: Fix Data Pipeline (Current Session)
1. Add logging to trace what payload reaches each AI generation step
2. Identify where user intent (domain + free-text) is being lost
3. Fix the data flow so all downstream steps receive the user's actual input
4. Verify by re-testing sleep flow: Portrait should show sleep content

### Phase 2: Domain-Specific Content (Next Session)
1. Create Portrait content templates/prompts for each domain (Sleep, Exercise, Finance, Home, Learning)
2. Create question filtering logic by domain
3. Create habit recommendation prompts that incorporate domain
4. Create anchor suggestion sets by domain

### Phase 3: Polish (Future)
1. Environment setup as optional first action
2. Design language refinements
3. Copy polish and typo fixes

---

## Test Cases for Verification

After fixes are implemented, verify with these test cases:

### Test Case 1: Sleep via Pill Selection
1. Click "Health & Fitness" → Click "Improve sleep"
2. **Verify:** Portrait shows sleep-specific content (wind-down, bedtime consistency, etc.)
3. **Verify:** Questions skip or adapt "When could you do this?"
4. **Verify:** Habit recommendations are sleep habits (phone away, dim lights, reading)
5. **Verify:** Anchors are evening-appropriate (after brushing teeth, etc.)

### Test Case 2: Sleep via Free-Text
1. Type "I want to sleep better and wake up at 6am"
2. **Verify:** Same as Test Case 1 — all downstream content is sleep-specific

### Test Case 3: Exercise via Pill Selection
1. Click "Health & Fitness" → Click "Start exercising regularly"
2. **Verify:** Portrait shows exercise-specific content (current content is actually correct for this)
3. **Verify:** Habit recommendations are exercise habits (pushups, walking, stretching)
4. **Verify:** Anchors are appropriate (morning coffee, getting out of bed, etc.)

### Test Case 4: State Contamination Check
1. Click "Health & Fitness" → Click "Start exercising regularly"
2. Then clear and type "I want to improve my sleep"
3. **Verify:** Downstream content is for SLEEP, not exercise (the text input should override the pill click)

---

## Domain-Specific Content Reference

Once the pipeline is fixed, here's reference content for the sleep domain:

### Sleep — Portrait of Excellence
```
PEOPLE WHO SUCCEED AT THIS
• They have a consistent wind-down signal that tells their brain "sleep is coming"
• They protect the hour before bed from screens and stimulating activities
• They've made their bedroom a sleep-only zone
• They're consistent with bedtime, even on weekends

THE JOURNEY
W1: Establish one consistent pre-sleep action
M1: Wind-down routine feels automatic; falling asleep is easier
M3: Sleep quality noticeably improved; morning energy better

COMMON TRAPS TO AVOID
• Trying to fix everything at once (screens, caffeine, timing, temperature)
• Inconsistent sleep schedule (weekend catch-up backfires)
• Using the bedroom for work or entertainment

HIGHEST-LEVERAGE STARTING MOVES
• Start with one consistent wind-down trigger
• Make the trigger something you actually enjoy
```

### Sleep — Recommended Habits
```
1. Put phone in another room 30 min before bed
   - Why: Removes biggest sleep disruptor; creates boundary
   - Suggested anchor: After brushing teeth at night

2. Dim lights 1 hour before bed
   - Why: Simple environmental cue; signals brain to wind down
   - Suggested anchor: After dinner cleanup

3. Read a physical book for 5 minutes in bed
   - Why: Replaces phone scrolling; naturally calming
   - Suggested anchor: After getting into bed
```

### Sleep — Anchor Suggestions
```
- After brushing teeth at night
- After putting on pajamas
- When I get into bed
- After dinner cleanup
- After setting tomorrow's alarm
- When I turn off the TV for the night
```

### Sleep — Context Questions
```
1. What usually disrupts your sleep?
   - Screens/phone before bed
   - Inconsistent schedule
   - Racing thoughts
   - Environment (noise, light, temperature)

2. Do you have a consistent bedtime?
   - Yes, within 30 minutes
   - Roughly, but weekends vary
   - No, it's all over the place

3. Have you tried building a sleep routine before?
   - First time
   - Tried once or twice
   - Tried many times
```