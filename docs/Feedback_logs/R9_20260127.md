Here's a detailed feedback document you can feed to Claude Code:

---

# Habit Stacker â€” Week 4 Implementation Context

## The Problem We Identified

**V0.4 is complete** â€” the conversational intake works, the runtime loop exists, the tune-up flow is in place. But looking at the home screen (see screenshot), there's a mismatch:

**We collect a lot of context:**
- Goal, blocker, timing, history
- Contextual follow-ups
- Pattern recognition in reflection
- "Why it fits" reasoning
- Environment priming, friction reduction, tiny versions (from tune-up)

**But we display very little:**
- Hero statement with emoji
- Rep count + last done
- CTA to mark rep
- Photo nudge card
- Collapsed "Why this works"

**The insight:** For all the effort the user puts into the consultation, the ongoing daily experience feels thin. The user has no sense of:
- Who they're becoming (identity)
- Where they are in the journey (progression)
- What they should set up in their environment (setup checklist)
- What patterns are emerging (after enough data)

This risks the "consult was cool, but I forgot why I'm doing this" problem by Week 2.

---

## New Framework: The AI's Roles

We developed a vocabulary for what the AI actually does across the habit lifecycle. This isn't just the intake agent â€” the AI serves multiple roles:

| Role | What It Does | When Active |
|------|--------------|-------------|
| **Designer** | Co-creates your system through conversation | Setup, Re-design |
| **Setup Guide** | Provides actionable checklist to prepare environment | Post-design, before first rep |
| **Tracker** | Records evidence of your reps | Daily execution |
| **Pattern Finder** | Identifies what's working, what breaks, when you're strongest | After 7+ reps |
| **Recovery Coach** | Normalizes misses, guides you back without shame | After miss |
| **Reflection Partner** | Facilitates periodic "is this still right?" conversations | Weekly/monthly boundaries |
| **Progression Planner** | Shows the arc from Week 1 â†’ mastery | After Week 1 stability |
| **Identity Narrator** | Reminds you who you're becoming and why | Throughout |

**Implementation implication:** The intake agent should generate more outputs that feed these other roles. Specifically, it should generate:
- `identity` â€” who the user is becoming
- `identityBehaviors` â€” what people with this identity typically do
- `setupChecklist` â€” environment prep tasks
- `progressionPlan` â€” the Week 1 â†’ Week 2 â†’ ... arc

---

## New Navigation Architecture

Instead of a flat structure, organize around three mental models:

```
HOME (/today or /)
â”œâ”€â”€ Your System â€” "What I do and how"
â”‚   â”œâ”€â”€ The Ritual (anchor â†’ action â†’ then)
â”‚   â”œâ”€â”€ The Toolkit (tiny version, env prime, friction)
â”‚   â”œâ”€â”€ Setup Checklist (interactive) â† NEW
â”‚   â”œâ”€â”€ When I Miss (recovery)
â”‚   â””â”€â”€ Why This Works (collapsible)
â”‚
â”œâ”€â”€ Your Journey â€” "How I'm doing"
â”‚   â”œâ”€â”€ Timeline (7-day dots â†’ calendar) â† NEW (dots this week)
â”‚   â”œâ”€â”€ Patterns (after 7+ reps) â† LATER
â”‚   â””â”€â”€ Photo Log (evidence gallery) â† LATER
â”‚
â””â”€â”€ Your Self â€” "Who I'm becoming"
    â”œâ”€â”€ Identity â† NEW
    â”œâ”€â”€ Progression â† NEW
    â””â”€â”€ Reflection (periodic check-in) â† LATER
```

**Implementation approach:** 
- The home screen should have navigation to these three tabs/sections
- Start with "Your System" expanded (it's what exists today as /system)
- "Your Journey" can start as just the 7-day dots
- "Your Self" can start as just Identity + Progression

---

## New Sections to Implement

### 1. Seven-Day History Dots (Your Journey â†’ Timeline)

**Purpose:** Visual feedback without a full tracker. Answers "Am I showing up?"

**Location:** Home screen, below the hero statement

**Design:**
```
M  T  W  T  F  S  S
â—  â—  â—  â—  â—‹  Â·  Â·
         â†‘
       Today
```
- â— = completed
- â—‹ = missed  
- Â· = future/no data

**Data source:** `repLogs` array â€” map by date

**Behavior:**
- Tapping could expand to full calendar view (later)
- No streak language â€” just visual dots
- Shows last 7 days rolling

---

### 2. Identity Section (Your Self â†’ Identity)

**Purpose:** Connect daily action to larger transformation. Answers "Who am I becoming?"

**Generated during:** Intake conversation (add to recommendation agent output)

**Data model addition to HabitSystem:**
```typescript
identity?: string;           // "Someone who protects their sleep"
identityBehaviors?: string[]; // ["Has a clear shutdown signal", "Keeps phone out of bedroom", ...]
```

**Display:**
```
WHO YOU'RE BECOMING

You're building the identity of someone who 
protects their sleep.

People with this identity typically:
â€¢ Have a clear "shutdown" signal each night
â€¢ Keep phones out of the bedroom
â€¢ Prioritize rest over "one more episode"
â€¢ Wake naturally without multiple alarms
```

**Generation prompt guidance:** Based on the user's goal + domain knowledge, generate:
1. A single identity statement (8-12 words)
2. 3-5 behaviors that people with this identity exhibit

---

### 3. Setup Checklist (Your System â†’ Setup Checklist)

**Purpose:** Bridge between "I have a system" and "I'm actually ready to execute"

**Generated from:** 
- Intake conversation (environment mentions)
- Tune-up conversation (environmentPrime, frictionReduced)
- Domain knowledge (common setup tasks for this habit type)

**Data model:**
```typescript
interface SetupItem {
  id: string;
  category: 'environment' | 'mental' | 'tech';
  text: string;
  completed: boolean;
  notApplicable: boolean;
}

// Add to HabitSystem:
setupChecklist?: SetupItem[];
```

**Display:**
```
YOUR SETUP CHECKLIST

Before your first rep, set yourself up for success:

Environment
â˜ Phone charging station set up outside bedroom
â˜ Book or magazine placed on pillow/nightstand
â˜ "Wind down" alarm created for 9pm

Mental
â˜ Told partner/roommate about new routine
â˜ Identified backup plan for travel nights

Tech
â˜ Do Not Disturb scheduled for 9pm-7am
â˜ Removed social apps from home screen (optional)

[2 of 7 complete]
```

**Behavior:**
- Checking an item persists to localStorage
- Can mark items "Not applicable" (strikethrough, doesn't count against total)
- Satisfying animation on check
- Progress shown as "X of Y complete"

**Generation:** Can be generated during intake OR during tune-up. For now, generate a default set based on habit category + any specific environment mentions from the conversation.

---

### 4. Progression Section (Your Self â†’ Progression)

**Purpose:** Show the arc from tiny start to sustainable system. Answers "What's next?"

**Generated from:** Domain knowledge + current stage (based on rep count / days active)

**Data model:**
```typescript
interface ProgressionStage {
  id: string;
  name: string;
  description: string;
  successCriteria: string;
  unlockAfter: string; // "0_reps", "7_reps", "14_days", etc.
}

// Add to HabitSystem:
currentStage?: string;        // "week_1", "week_2", etc.
progressionPlan?: ProgressionStage[];
```

**Display:**
```
YOUR PROGRESSION

Week 1: SHOW UP â† You are here
Just do the action. Don't optimize.
Success = doing it, regardless of quality.

Week 2: PROTECT THE STREAK
Now that it's automatic, notice what threatens it.
Success = recovering quickly from misses.

Week 3: ADD THE REWARD
Link the habit to something you enjoy.
Success = looking forward to the routine.

Week 4: REFLECT & ADJUST
Is this the right habit? Time to tune.
Success = honest assessment, one adjustment.
```

**Behavior:**
- Current stage highlighted (different background color)
- Future stages slightly dimmed but visible
- Stage advances automatically based on rep count + time
- Tapping a stage could show more detail (later)

**For now:** Can be static/templated based on habit category. Don't need AI generation for v1.

---

## Progressive Disclosure Rules

Everything should be *available* if the user digs, but only *surfaced* (prompted/highlighted) when meaningful:

| Section | Available When | Surfaced When |
|---------|----------------|---------------|
| The Ritual | After design | Always on home |
| Setup Checklist | After design | Before first rep (card prompt) |
| The Toolkit | After tune-up | After tune-up completes |
| Timeline (7-day dots) | After 1 rep | After 3 reps |
| Patterns | After 7 reps | After pattern detected |
| Identity | After design | After first rep |
| Progression | After design | After Week 1 complete |
| Reflection | Always | At weekly boundary |
| Photo Log | After 1 photo | After 3 photos |
| Why This Works | Always | Never (user-initiated only) |

---

## Home Screen Evolution

The home screen should become a hub with navigation:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              YOUR HABIT                  â”‚
â”‚                                          â”‚
â”‚  ğŸ“–                                      â”‚
â”‚  "When I [anchor], I [action]."          â”‚
â”‚                                          â”‚
â”‚  â— â— â— â— â—‹ Â· Â·  â† 7-day dots (NEW)      â”‚
â”‚  M T W T F S S                           â”‚
â”‚                                          â”‚
â”‚     4 Reps  â€¢  Today  â€¢  Week 1          â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      Mark today's rep           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ System  â”‚ â”‚ Journey â”‚ â”‚  Self   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  [Contextual card based on state]        â”‚
â”‚  â€¢ "Complete your setup checklist (3/7)" â”‚
â”‚  â€¢ "Tune your system" (existing)         â”‚
â”‚  â€¢ "New pattern detected"                â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Priority for This Week

**Day 1-2: Foundation**
1. Add 7-day dots component to home screen
2. Update intake agent to generate `identity` + `identityBehaviors`
3. Store in HabitSystem

**Day 3: Identity Display**
4. Add Identity section to /system page (or new /self route)
5. Update home screen with tab navigation (System / Journey / Self)

**Day 4: Setup Checklist**
6. Generate setupChecklist during intake (based on category + env mentions)
7. Build interactive checklist component with persistence
8. Add to /system page

**Day 5: Progression**
9. Add static progression plan (templated by category)
10. Display current stage based on rep count
11. Polish navigation between tabs

**Weekend: Start self-use**
- Use the app daily
- Note friction points

---

## Files Likely to Change

- `src/types/habit.ts` â€” Add identity, identityBehaviors, setupChecklist, progressionPlan to HabitSystem
- `src/lib/ai/prompts/intakeAgent.ts` â€” Update to generate identity + setup checklist
- `src/app/page.tsx` â€” Add 7-day dots, tab navigation
- `src/app/system/page.tsx` â€” Add Setup Checklist, Identity sections (or split into tabs)
- New component: `src/components/SevenDayDots.tsx`
- New component: `src/components/SetupChecklist.tsx`
- New component: `src/components/IdentitySection.tsx`
- New component: `src/components/ProgressionSection.tsx`

---

## Key Principle

**The intake conversation is valuable. Don't waste it.**

Every piece of context the user shares should translate into something they see later:
- Their blocker â†’ why the habit was designed this way
- Their timing â†’ the anchor
- Their history â†’ the "why this is different" framing
- Their environment mentions â†’ the setup checklist
- Their goal â†’ the identity they're building

The user should feel like the system *remembers* and *uses* what they shared.