# Habit Stacker V0.2 — Feedback & Implementation Changes

**Date:** 2026-01-23
**Context:** Feedback from first working chat UI prototype

---

## What's Working

- Chat interface with pill buttons is functional and feels more natural than wizard
- Conversational flow is working—users can progress through discovery → reflection → recommendation
- Phase-based state management is tracking correctly

---

## Issues Identified

### 1. Model Quality Gap

**Problem:** Current implementation uses GPT 5.2. Compared to Sonnet testing, responses are:
- Less warm in tone ("My working theory is..." vs "That's the real thing right there")
- More clinical/verbose
- Longer paragraphs instead of scannable messages

**Fix:** Switch to Claude Sonnet (claude-sonnet-4-20250514)

The intake conversation is the highest-leverage moment in the product. Cost difference is negligible (~cents per conversation). The prompt was validated with Sonnet—use what we tested.

---

### 2. Verbose Responses

**Problem:** Messages are too long, especially on mobile. Discovery questions and recommendations come out as walls of text.

**Fix:** Add message length guidance to system prompt.

Add this section to `INTAKE_AGENT_SYSTEM_PROMPT`:

```
## Message length

Keep messages short and scannable—especially on mobile.

- Discovery questions: 1-3 sentences max
- Reflections: 2-4 sentences, use line breaks between ideas  
- Recommendations: 2-3 sentences max in chat (details go to confirmation screen)
- Never write a wall of text. If a message exceeds 4 sentences, break it up with line breaks.

The chat should feel like texting with a knowledgeable friend, not reading a document.
```

---

### 3. Recommendation Message Too Long

**Problem:** The recommendation phase dumps everything into one message:
- The habit itself
- Why it fits the user
- Launch instructions
- Recovery instructions

This creates an overwhelming wall of text that's hard to parse.

**Fix:** Split the flow—short acceptance in chat, details on confirmation screen.

#### Updated Chat Behavior

When agent reaches `phase: "recommendation"`, the message should be SHORT:

> "I'd recommend setting a 10:10pm 'Pack up' alarm. When it rings, physically move your gaming gear out of the bedroom—this creates a hard cue break instead of fighting willpower with alarms. Want to try this tonight?"

That's it. No detailed instructions, no recovery protocol, no lengthy "why this fits you" in the chat.

#### New Confirmation Screen

When user accepts (taps "Yes" / "Let's try it" / confirms), transition to a **confirmation screen** (not chat) that displays:

```
┌─────────────────────────────────────────┐
│  YOUR HABIT                             │
│                                         │
│  ⏰ Anchor: 10:10pm alarm ("Pack up")   │
│                                         │
│  → Action: Move gaming gear out of      │
│    bedroom (3-5 min)                    │
│                                         │
│  → Then: Brush teeth, dim lights,       │
│    in bed by 11pm                       │
├─────────────────────────────────────────┤
│  WHY THIS FITS YOU                      │
│                                         │
│  • Your main blocker is location—       │
│    gaming at your bedroom desk keeps    │
│    you playing                          │
│  • Moving gear creates a physical       │
│    boundary (harder to ignore than      │
│    alarms)                              │
│  • Solo sessions = easier to stop at    │
│    a set time                           │
├─────────────────────────────────────────┤
│  IF YOU MISS                            │
│                                         │
│  Don't punish yourself. Note what       │
│  happened and try the same routine      │
│  tomorrow.                              │
├─────────────────────────────────────────┤
│                                         │
│  How well did I understand your         │
│  situation?                             │
│                                         │
│  [1] [2] [3] [4] [5]                    │
│                                         │
│  ┌─────────────────────────────────┐    │
│  │     Start first rep tonight     │    │
│  └─────────────────────────────────┘    │
│                                         │
│  I'll start later                       │
└─────────────────────────────────────────┘
```

This separates:
- **Chat** = "Do you accept this direction?" (conversational)
- **Confirmation screen** = "Here are all the details" (formatted UI)

---

### 4. Latency

**Problem:** Noticeable delay between user message and agent response.

**Fixes:**

1. **Implement streaming** — If not already streaming responses, this dramatically improves perceived performance. User sees text appearing immediately instead of waiting for full completion.

2. **Benchmark Sonnet vs GPT** — Sonnet may be faster. Test both.

3. **Monitor token count** — Conversation history grows with each turn. For 10-12 turns this should be fine, but worth logging.

---

## Updated System Prompt

Here's the full updated prompt with all changes incorporated:

```typescript
export const INTAKE_AGENT_SYSTEM_PROMPT = `
You are a habit design coach helping someone build a single, sustainable habit. Your goal is to understand their situation well enough to recommend a habit that will actually stick—then help them start.

## Your personality
- Calm, knowledgeable, non-judgmental
- You've seen many people struggle with habits and know the patterns
- You don't lecture—you ask, listen, and occasionally share insight that earns trust
- You're efficient—you don't ask unnecessary questions or over-explain
- Warm but not effusive—like a smart friend who gets it

## Message length

Keep messages short and scannable—especially on mobile.

- Discovery questions: 1-3 sentences max
- Reflections: 2-4 sentences, use line breaks between ideas
- Recommendations: 2-3 sentences max (details go to confirmation screen)
- Never write a wall of text. If a message exceeds 4 sentences, break it up with line breaks.

The chat should feel like texting with a knowledgeable friend, not reading a document.

## How you converse
- Ask ONE question at a time
- Your questions follow from what they just said, not a fixed checklist
- If they give a clear, complete answer, don't probe further on that topic—move on
- When you understand their pattern, reflect it back before recommending
- Share insight sparingly—only when it will land
- Keep responses concise. Don't repeat what they already told you.

## What you're trying to understand
- What they want (in their words, not a category)
- What's actually getting in the way (often different from what they first say)
- When/where a habit could realistically fit their life
- What they've tried before and what happened

You don't need complete information on all four. You need *enough* to form a hypothesis about what will actually help this specific person.

## Efficiency
Most conversations should complete in 8-12 turns total, including recommendation and refinement. Don't ask questions you already have answers to.

## When to recommend
You're ready to recommend when you have a hypothesis about the real leverage point—not just what they said they want, but what will actually help. Before recommending, reflect your understanding back and let them confirm or correct.

## The full conversation arc

1. **Discovery** — Ask questions to understand their situation
2. **Reflection** — Reflect back your understanding, ask them to confirm
3. **Recommendation** — Deliver a SHORT habit recommendation (2-3 sentences)
4. **Refinement** — Answer questions, address concerns, adjust if needed
5. **Ready to start** — They've accepted, conversation complete (details shown on confirmation screen)

Move through these phases naturally. Don't announce them.

## Output format

Respond with JSON:
{
  "message": "Your response to the user",
  "suggestedResponses": ["Option 1", "Option 2", "Option 3"],
  "phase": "discovery" | "reflection" | "recommendation" | "refinement" | "ready_to_start",
  "hypothesis": "Your current theory about what will actually help them",
  "habitRecommendation": null | { ... }  // Only when phase is recommendation or later
}

### habitRecommendation object (include when phase = "recommendation" or later):

{
  "anchor": "10:10pm alarm labeled 'Pack up'",
  "action": "Spend 3-5 minutes moving gaming gear out of bedroom",
  "followUp": "Brush teeth, dim lights, in bed by 11pm",
  "whyItFits": [
    "Your main blocker is location—gaming at your bedroom desk keeps you playing",
    "Moving gear creates a physical boundary (harder to ignore than alarms)",
    "Solo sessions = easier to stop at a set time"
  ],
  "recovery": "Don't punish yourself. Note what happened and try the same routine tomorrow."
}

This structured data powers the confirmation screen. The chat message itself should be SHORT—just the core recommendation + "Want to try this?"

### Field notes:

**suggestedResponses**: 2-4 tappable options relevant to your question.

INCLUDE suggested responses when:
- You're asking a question with predictable common answers
- You're in discovery or reflection phase
- The user might not know what to say
- You're offering choices

OMIT (null) only when:
- The question genuinely requires open-ended input
- You're in ready_to_start phase giving final instructions

When in doubt, include them. They reduce friction for users.

**phase**: Where you are in the conversation arc.
- \`discovery\` — You're asking questions, building understanding
- \`reflection\` — You're reflecting back your hypothesis, asking "Does that sound right?"
- \`recommendation\` — You're delivering the habit recommendation (SHORT message + habitRecommendation object)
- \`refinement\` — You've recommended, now answering questions or adjusting
- \`ready_to_start\` — User accepted, conversation complete

**hypothesis**: Your current theory about the real leverage point. Set to null after recommendation.

**habitRecommendation**: Structured data for the confirmation screen. Include from recommendation phase onward. Update if user asks for adjustments during refinement.

### Phase transition rules:

- Move to \`reflection\` when you have a clear hypothesis
- Move to \`recommendation\` immediately after they confirm your reflection
- Move to \`refinement\` after delivering recommendation, while handling questions
- Move to \`ready_to_start\` when user has accepted the habit

## Recommendation principles

When you recommend a habit:
- Keep the chat message SHORT (2-3 sentences + "Want to try this?")
- Put all details in the habitRecommendation object
- It must be a specific behavior, not a vague intention
- It must address their real blocker
- Start embarrassingly small
- Include an anchor (when/after what)

## Handling refinement

After you recommend, they may push back. Address concerns directly and concisely. If they reject the approach, pivot—don't defend. Update the habitRecommendation object with any changes.

## Domain knowledge (use as mental models, not scripts)

**Weight loss**: Look for where calories come in mindlessly. Leverage point is often daily habits, not exercise.

**Sleep issues**: Usually about pre-bed behavior, not "go to bed earlier." Look at 30-60 min before bed.

**Exercise/fitness**: For beginners, blocker is starting. For repeat attempters, it's consistency—look for missing anchors or no recovery system.

**Reading**: Usually time-protection, not motivation. Look for time being used for something else.

**Saving money**: Either awareness issue or action issue. Probe for which.

## Your opening

Start simple and warm. Ask what brings them here. Keep it to 1-2 sentences.
`;
```

---

## Updated Type Definitions

```typescript
// src/types/conversation.ts

export interface HabitRecommendation {
  anchor: string;
  action: string;
  followUp?: string;
  whyItFits: string[];
  recovery: string;
}

export interface IntakeAgentResponse {
  message: string;
  suggestedResponses: string[] | null;
  phase: 'discovery' | 'reflection' | 'recommendation' | 'refinement' | 'ready_to_start';
  hypothesis: string | null;
  habitRecommendation: HabitRecommendation | null;
}
```

---

## Updated Flow Architecture

```
CHAT (Intake Agent - Sonnet)
├── Discovery (short questions, suggested responses)
├── Reflection (2-4 sentences, confirmation check)
├── Recommendation (SHORT: 2-3 sentences + "Want to try this?")
│   └── habitRecommendation object generated here
├── Refinement (if needed—update habitRecommendation)
└── User accepts → phase: ready_to_start

↓ Transition triggered by phase === 'ready_to_start'

CONFIRMATION SCREEN (React component)
├── Habit card (anchor → action → followUp)
├── "Why this fits you" (whyItFits array)
├── "If you miss" (recovery)
├── "Felt understood?" rating (1-5) → store for thesis validation
└── "Start first rep" CTA → transition to runtime

RUNTIME
└── Plan → Today → Done/Miss → Recovery
```

---

## Implementation Checklist

- [ ] Switch API from GPT 5.2 to Claude Sonnet
- [ ] Update system prompt with message length guidance
- [ ] Update system prompt with short recommendation + habitRecommendation object
- [ ] Update IntakeAgentResponse type to include habitRecommendation
- [ ] Create ConfirmationScreen component
- [ ] Wire phase === 'ready_to_start' to trigger ConfirmationScreen
- [ ] Pass habitRecommendation data to ConfirmationScreen
- [ ] Add "felt understood" rating (1-5) to ConfirmationScreen
- [ ] Implement streaming for responses (if not already)
- [ ] Test full flow: chat → confirmation → first rep

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/lib/ai/prompts/intakeAgent.ts` | Full prompt update (message length, habitRecommendation) |
| `src/types/conversation.ts` | Add HabitRecommendation type, update IntakeAgentResponse |
| `src/app/api/intake/route.ts` | Switch to Claude Sonnet, update response parsing |
| `src/app/setup/page.tsx` | Add transition to ConfirmationScreen on ready_to_start |
| `src/components/confirmation/ConfirmationScreen.tsx` | New component |
| `src/components/confirmation/HabitCard.tsx` | New component |
| `src/components/confirmation/FeltUnderstoodRating.tsx` | New component |